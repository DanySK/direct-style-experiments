<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Channels as a communication primitive # The fourth, yet not mentioned, abstraction of both Kotlin Coroutines and Scala Gears is the channel. Channels represent the primitive communication and coordination means to exchange Future (or coroutines in the case of Kotlin) results. They are, at least conceptually, very similar to a queue where it is possible to send (and receive) data &ndash; basically, exploiting the producer-consumer pattern.
classDiagram class `SendableChannel[-T]` { &lt;&lt; trait &gt;&gt; &#43;sendSource(x: T) Async.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="Channels as a communication primitive # The fourth, yet not mentioned, abstraction of both Kotlin Coroutines and Scala Gears is the channel. Channels represent the primitive communication and coordination means to exchange Future (or coroutines in the case of Kotlin) results. They are, at least conceptually, very similar to a queue where it is possible to send (and receive) data &ndash; basically, exploiting the producer-consumer pattern.
classDiagram class `SendableChannel[-T]` { &lt;&lt; trait &gt;&gt; &#43;sendSource(x: T) Async." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tassiluca.github.io/PPS-22-direct-style-experiments/docs/03-channels/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2024-02-29T17:32:36+01:00" />

<title>03 Channels | PPS-22-direct-style-experiments</title>
<link rel="manifest" href="/PPS-22-direct-style-experiments/manifest.json">
<link rel="icon" href="/PPS-22-direct-style-experiments/favicon.png" >
<link rel="canonical" href="https://tassiluca.github.io/PPS-22-direct-style-experiments/docs/03-channels/">
<link rel="stylesheet" href="/PPS-22-direct-style-experiments/book.min.8b7763bbc30daa9cc9cbd3d86de971ec810e418df80eaa491030277c990276b4.css" integrity="sha256-i3dju8MNqpzJy9PYbelx7IEOQY34DqpJEDAnfJkCdrQ=" crossorigin="anonymous">
  <script defer src="/PPS-22-direct-style-experiments/flexsearch.min.js"></script>
  <script defer src="/PPS-22-direct-style-experiments/en.search.min.4bc61e6195a0429ff26b3138ef7c229d75957572080ba17944c31fb4ba8b6adb.js" integrity="sha256-S8YeYZWgQp/yazE473winXWVdXIIC6F5RMMftLqLats=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/PPS-22-direct-style-experiments/"><span>PPS-22-direct-style-experiments</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/01-boundaries/" class="">01 Boundaries</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/02-basics/" class="">02 Basics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/03-channels/" class="active">03 Channels</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/04-rears/" class="">04 Rears</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/05-conclusions/" class="">05 Conclusions</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/PPS-22-direct-style-experiments/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>03 Channels</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="channels-as-a-communication-primitive">
  Channels as a communication primitive
  <a class="anchor" href="#channels-as-a-communication-primitive">#</a>
</h1>
<p>The fourth, yet not mentioned, abstraction of both Kotlin Coroutines and Scala Gears is the <strong>channel</strong>.
Channels represent the <strong>primitive communication and coordination means</strong> to exchange <code>Future</code> (or coroutines in the case of Kotlin) results. They are, at least conceptually, very similar to a queue where it is possible to send (and receive) data &ndash; basically, exploiting the <em><strong>producer-consumer</strong></em> pattern.</p>


<script src="/PPS-22-direct-style-experiments/mermaid.min.js"></script>

  <script>mermaid.initialize({
    "flowchart": {
        "useMaxWidth":true
    },
    "theme": "default"
})</script>




<p class="mermaid">
classDiagram
  class `SendableChannel[-T]` {
    << trait >>
    +sendSource(x: T) Async.Source[Either[Closed, Unit]]
    +send(x: T)(using Async) Unit
  }

  class `ReadableChannel[+T]` {
    << trait >>
    +readSource Async.Source[Either[Closed, T]]
    +read()(using Async) Either[Closed, T]
  }

  class `Channel[T]` {
    << trait >>
    +asSendable: SendableChannel[T]
    +asReadable: ReadableChannel[T]
    +asCloseable: java.io.Closeable
  }

  namespace java io {
    class Closeable {
      << interface >>
      +close()
    }
  }

  `SendableChannel[-T]` <|-- `Channel[T]`
  Closeable <|-- `Channel[T]`
  `ReadableChannel[+T]` <|-- `Channel[T]`
</p>

<p>The channel is defined through three distinct interfaces: <code>SendableChannel[-T]</code>, <code>ReadableChannel[+T]</code> and <code>Channel[T]</code>, where the latter extends from both <code>SendableChannel</code> and <code>ReadableChannel</code>. Typically, a <code>Channel</code> is created and a <code>SendableChannel</code> and <code>ReadableChannel</code> instances are respectively provided to the producer and the consumer, restricting their access to it. The same, almost identical, design is present also in Kotlin Coroutines where <code>SendChannel</code> and <code>ReceiveChannel</code> take respectively over the Gears <code>SendableChannel</code> and <code>ReadableChannel</code>.</p>
<p>Moreover, <code>Channel</code> inherits from <code>java.io.Closable</code>, making them closable objects: once closed, they raise <code>ChannelClosedException</code> when attempting to write to them and immediately return a <code>Left(Closed)</code> when attempting to read from them, preventing the consumer from finishing reading all the values sent on the channel before its closing.
This is not the case for Kotlin Coroutines where closing a channel indicates that no more values are coming, but doesn&rsquo;t prevent consuming already sent values. Moreover, in Kotlin is possible to use a regular for loop to receive elements from a channel (blocking the coroutine):</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#8839ef">val</span> <span style="color:#fe640b">channel</span> = Channel&lt;Int&gt;()
</span></span><span style="display:flex;"><span>launch {
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">for</span> (x <span style="color:#8839ef">in</span> <span style="color:#fe640b">1.</span>.<span style="color:#fe640b">5</span>) channel.send(x * x)
</span></span><span style="display:flex;"><span>    channel.close() <span style="color:#9ca0b0;font-style:italic">// we&#39;re done sending
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>}
</span></span><span style="display:flex;"><span><span style="color:#8839ef">for</span> (y <span style="color:#8839ef">in</span> channel) println(y) <span style="color:#9ca0b0;font-style:italic">// blocks until channel is closed
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>println(<span style="color:#40a02b">&#34;Done!&#34;</span>)
</span></span></code></pre></div><p>A similar behavior can be achieved also in Gears pimping the framework with the concept of <code>Terminable</code> channel. After all, closing a channel in coroutines is a matter of sending a special token to it: the iteration stops as soon as this token is received.</p>
<p><code>TBD</code></p>
<p>Three types of channels exists:</p>
<ul>
<li><strong>Synchronous Channels</strong>: links a <code>read</code> request with a <code>send</code> within a <em>rendezvous</em>
<ul>
<li><code>send</code> (<code>read</code>) suspend the process until a consumer <code>read</code> (<code>send</code>) the value;</li>
<li>in Kotlin they are called <strong>Rendezvous Channels</strong>.</li>
</ul>
</li>
<li><strong>Buffered Channels</strong>: a version of a channel with an internal buffer of fixed size
<ul>
<li><code>send</code> suspend the producer process if it is full; otherwise, it appends the value to the buffer, returning immediately;</li>
<li><code>read</code> suspend if the channel is empty, waiting for a new value.</li>
</ul>
</li>
<li><strong>Unbounded Channels</strong>: a version of a channel with an unbounded buffer
<ul>
<li>if the programs run out of memory you can get an out-of-memory exception!</li>
<li>in Kotlin they are called <strong>Unlimited Channel</strong>.</li>
</ul>
</li>
</ul>
<p>Kotlin offers also a fourth type: the <strong>Conflated Channel</strong>, where every new element sent to it overwirtes the previously sent one, <em>never blocking</em>, so that the receiver gets always the latest element.</p>
<p>Concerning channel behavior, it is important to note that:</p>
<blockquote>
<ol>
<li>Multiple producers can send data to the channel, as well as multiple consumers can read them, <strong>but each element is handled only <em>once</em>, by <em>one</em> of them</strong>, i.e. consumers <strong>compete</strong> with each other for sent values;</li>
<li>Once the element is handled, it is immediately removed from the channel;</li>
<li>Fairness: <code>TBD</code></li>
</ol>
</blockquote>
<h2 id="analyzer-example">
  Analyzer example
  <a class="anchor" href="#analyzer-example">#</a>
</h2>
<p>To show channels in action an example has been prepared:</p>
<blockquote class="book-hint info">
  <strong>Idea</strong>: we want to realize a little asynchronous library allowing clients to collect the common statistics about repositories (issues, stars, last release) and contributors of a given GitHub organization.
</blockquote>

<p>The final result is a GUI application that, given an organization name, starts the analysis of all its repositories,
listing their information along with all their contributors as soon as they are computed. Moreover, the application allows the user to cancel the current computation at any point in time.</p>
<p><img src="../../res/img/analyzer-e2e.png" alt="expected result" /></p>
<p>The example is structured in two different packages: <code>lib</code> and <code>client</code>. The former contains the logic of the library, while the latter contains the application (client code).
As usual, it has been implemented using monadic <code>Future</code>s, as well as using Scala Gears and Kotlin Coroutines.</p>
<h3 id="future-monadic-version">
  Future monadic version
  <a class="anchor" href="#future-monadic-version">#</a>
</h3>
<p>The entry point of the library is the <code>Analyzer</code> interface which takes in input the organization name and a function through which is possible to react to results while they are computed.</p>
<p>Since we want to achieve cancellation, the monadic version leverages Monix <code>Task</code>s which is returned by the <code>analyze</code> method wrapped in an <code>EitherT</code> monad transformer to allow handling errors functionally.</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">trait</span> <span style="color:#df8e1d">Analyzer</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">def</span> <span style="color:#d20f39">analyze</span><span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#d20f39">organizationName:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#d20f39">updateResult:</span> <span style="color:#d20f39">RepositoryReport</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span> <span style="color:#d20f39">Unit</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">EitherT</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Task</span>, <span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]]</span>
</span></span></code></pre></div><p>To retrieve data from GitHub, a <code>RepositoryService</code> interface has been created, following the same pattern:</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">trait</span> <span style="color:#df8e1d">RepositoryService</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">def</span> <span style="color:#d20f39">repositoriesOf</span><span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#d20f39">organizationName:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#d20f39">:</span> <span style="color:#d20f39">EitherT</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Task</span>, <span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Repository</span><span style="color:#04a5e5;font-weight:bold">]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">def</span> contributorsOf<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">,</span> repositoryName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">EitherT</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Task</span>, <span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Contribution</span><span style="color:#04a5e5;font-weight:bold">]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">def</span> lastReleaseOf<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">,</span> repositoryName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">EitherT</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Task</span>, <span style="color:#d20f39">String</span>, <span style="color:#d20f39">Release</span><span style="color:#04a5e5;font-weight:bold">]</span>
</span></span></code></pre></div><p>The implementation of the <code>Analyzer</code> is shown in the following code snippet and performs the following steps:</p>
<ol>
<li>first, the list of repositories is retrieved;</li>
<li>if no error occurred, the analysis of each repository is performed concurrently, thanks to the <code>Traverse</code> functor offered by Cats;</li>
<li>the analysis of each repository consists of retrieving the contributors and the last release of the repository and then updating the result through the <code>updateResult</code> function. Since both the contributors and last release retrieval are independent of each other, they are performed concurrently, thanks to <code>Task.parZip2</code>.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">override</span> <span style="color:#8839ef">def</span> analyze<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span>
</span></span><span style="display:flex;"><span>    updateResult<span style="color:#8839ef">:</span> <span style="color:#d20f39">RepositoryReport</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span> <span style="color:#df8e1d">Unit</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">EitherT</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Task</span>, <span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]]</span> <span style="color:#8839ef">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">for</span>
</span></span><span style="display:flex;"><span>    repositories <span style="color:#8839ef">&lt;-</span> gitHubService<span style="color:#04a5e5;font-weight:bold">.</span>repositoriesOf<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#9ca0b0;font-style:italic">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>    reports <span style="color:#8839ef">&lt;-</span> repositories<span style="color:#04a5e5;font-weight:bold">.</span>traverse<span style="color:#04a5e5;font-weight:bold">(</span>r <span style="color:#8839ef">=&gt;</span> <span style="color:#df8e1d">EitherT</span><span style="color:#04a5e5;font-weight:bold">.</span>right<span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#04a5e5;font-weight:bold">.</span>performAnalysis<span style="color:#04a5e5;font-weight:bold">(</span>updateResult<span style="color:#04a5e5;font-weight:bold">)))</span> <span style="color:#9ca0b0;font-style:italic">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>  <span style="color:#8839ef">yield</span> reports
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>extension <span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#8839ef">:</span> <span style="color:#d20f39">Repository</span><span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">private</span> <span style="color:#8839ef">def</span> performAnalysis<span style="color:#04a5e5;font-weight:bold">(</span>updateResult<span style="color:#8839ef">:</span> <span style="color:#d20f39">RepositoryReport</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span> <span style="color:#df8e1d">Unit</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Task</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]</span> <span style="color:#8839ef">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">val</span> contributorsTask <span style="color:#8839ef">=</span> gitHubService<span style="color:#04a5e5;font-weight:bold">.</span>contributorsOf<span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#04a5e5;font-weight:bold">.</span>organization<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>name<span style="color:#04a5e5;font-weight:bold">).</span>value
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">val</span> releaseTask <span style="color:#8839ef">=</span> gitHubService<span style="color:#04a5e5;font-weight:bold">.</span>lastReleaseOf<span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#04a5e5;font-weight:bold">.</span>organization<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>name<span style="color:#04a5e5;font-weight:bold">).</span>value
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">for</span>
</span></span><span style="display:flex;"><span>      result <span style="color:#8839ef">&lt;-</span> <span style="color:#df8e1d">Task</span><span style="color:#04a5e5;font-weight:bold">.</span>parZip2<span style="color:#04a5e5;font-weight:bold">(</span>contributorsTask<span style="color:#04a5e5;font-weight:bold">,</span> releaseTask<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      report <span style="color:#8839ef">=</span> <span style="color:#df8e1d">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#04a5e5;font-weight:bold">.</span>name<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>issues<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>stars<span style="color:#04a5e5;font-weight:bold">,</span> result<span style="color:#04a5e5;font-weight:bold">.</span>_1<span style="color:#04a5e5;font-weight:bold">.</span>getOrElse<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#df8e1d">Seq</span><span style="color:#04a5e5;font-weight:bold">.</span>empty<span style="color:#04a5e5;font-weight:bold">),</span> result<span style="color:#04a5e5;font-weight:bold">.</span>_2<span style="color:#04a5e5;font-weight:bold">.</span>toOption<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#8839ef">_</span> <span style="color:#8839ef">&lt;-</span> <span style="color:#df8e1d">Task</span><span style="color:#04a5e5;font-weight:bold">(</span>updateResult<span style="color:#04a5e5;font-weight:bold">(</span>report<span style="color:#04a5e5;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">yield</span> report
</span></span></code></pre></div><p>Client-side, when a new session is requested, the <code>Analyzer</code> is used to start the computation, during which the single reports are aggregated and the UI is updated.
Whenever desired, the current computation can be stopped by canceling the Monix <code>CancelableFuture</code> returned by the <code>runToFuture</code> method, through which the returned Task from the <code>Analyzer</code> is started.</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">class</span> <span style="color:#df8e1d">MonadicAppController</span> <span style="color:#8839ef">extends</span> <span style="color:#df8e1d">AppController</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">import</span> <span style="color:#d20f39">monix.execution.Scheduler.Implicits.global</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">private</span> <span style="color:#8839ef">val</span> view <span style="color:#8839ef">=</span> <span style="color:#df8e1d">AnalyzerView</span><span style="color:#04a5e5;font-weight:bold">.</span>gui<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">this</span><span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">private</span> <span style="color:#8839ef">val</span> analyzer <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Analyzer</span><span style="color:#04a5e5;font-weight:bold">.</span>ofGitHub<span style="color:#04a5e5;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">private</span> <span style="color:#8839ef">var</span> currentComputation<span style="color:#8839ef">:</span> <span style="color:#d20f39">Option</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">CancelableFuture</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Unit</span><span style="color:#04a5e5;font-weight:bold">]]</span> <span style="color:#8839ef">=</span> <span style="color:#df8e1d">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  view<span style="color:#04a5e5;font-weight:bold">.</span>run<span style="color:#04a5e5;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">override</span> <span style="color:#8839ef">def</span> runSession<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Unit</span> <span style="color:#04a5e5;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">var</span> organizationReport<span style="color:#8839ef">:</span> <span style="color:#d20f39">OrganizationReport</span> <span style="color:#04a5e5;font-weight:bold">=</span> <span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#df8e1d">Map</span><span style="color:#04a5e5;font-weight:bold">(),</span> <span style="color:#df8e1d">Set</span><span style="color:#04a5e5;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">val</span> f <span style="color:#8839ef">=</span> analyzer<span style="color:#04a5e5;font-weight:bold">.</span>analyze<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#04a5e5;font-weight:bold">{</span> report <span style="color:#8839ef">=&gt;</span>
</span></span><span style="display:flex;"><span>      organizationReport <span style="color:#8839ef">=</span> organizationReport<span style="color:#04a5e5;font-weight:bold">.</span>mergeWith<span style="color:#04a5e5;font-weight:bold">(</span>report<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      view<span style="color:#04a5e5;font-weight:bold">.</span>update<span style="color:#04a5e5;font-weight:bold">(</span>organizationReport<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#04a5e5;font-weight:bold">}.</span>value<span style="color:#04a5e5;font-weight:bold">.</span>runToFuture<span style="color:#04a5e5;font-weight:bold">.</span>map <span style="color:#04a5e5;font-weight:bold">{</span> <span style="color:#8839ef">case</span> <span style="color:#df8e1d">Left</span><span style="color:#04a5e5;font-weight:bold">(</span>value<span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#8839ef">=&gt;</span> view<span style="color:#04a5e5;font-weight:bold">.</span>error<span style="color:#04a5e5;font-weight:bold">(</span>value<span style="color:#04a5e5;font-weight:bold">);</span> <span style="color:#8839ef">case</span> <span style="color:#8839ef">_</span> <span style="color:#8839ef">=&gt;</span> view<span style="color:#04a5e5;font-weight:bold">.</span>endComputation<span style="color:#04a5e5;font-weight:bold">()</span> <span style="color:#04a5e5;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    currentComputation <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Some</span><span style="color:#04a5e5;font-weight:bold">(</span>f<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">override</span> <span style="color:#8839ef">def</span> stopSession<span style="color:#04a5e5;font-weight:bold">()</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Unit</span> <span style="color:#04a5e5;font-weight:bold">=</span> currentComputation foreach <span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">_</span><span style="color:#04a5e5;font-weight:bold">.</span>cancel<span style="color:#04a5e5;font-weight:bold">())</span>
</span></span></code></pre></div><h3 id="scala-gears-version">
  Scala Gears version
  <a class="anchor" href="#scala-gears-version">#</a>
</h3>
<p>The interfaces of the Direct Style with Gears differ from the monadic one by their return type, which is a simpler <code>Either</code> data type, and by the fact they are <strong>suspendable</strong> functions, hence they require an Async context to be executed.</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">trait</span> <span style="color:#df8e1d">Analyzer</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">def</span> <span style="color:#d20f39">analyze</span><span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#d20f39">organizationName:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#d20f39">updateResults:</span> <span style="color:#d20f39">RepositoryReport</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span> <span style="color:#d20f39">Unit</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">trait</span> <span style="color:#df8e1d">RepositoryService</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">def</span> <span style="color:#d20f39">repositoriesOf</span><span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#d20f39">organizationName:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span><span style="color:#d20f39">using</span> <span style="color:#d20f39">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#d20f39">:</span> <span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Repository</span><span style="color:#04a5e5;font-weight:bold">]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">def</span> contributorsOf<span style="color:#04a5e5;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    repositoryName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span>
</span></span><span style="display:flex;"><span>  <span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Contribution</span><span style="color:#04a5e5;font-weight:bold">]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">def</span> lastReleaseOf<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">,</span> repositoryName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Release</span><span style="color:#04a5e5;font-weight:bold">]</span>
</span></span></code></pre></div><p>The implementation of the <code>Analyzer</code> leverages Channels to perform the concurrent analysis of the repositories:</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">override</span> <span style="color:#8839ef">def</span> analyze<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span>
</span></span><span style="display:flex;"><span>      updateResults<span style="color:#8839ef">:</span> <span style="color:#d20f39">RepositoryReport</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span> <span style="color:#df8e1d">Unit</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]]</span> <span style="color:#8839ef">=</span> either<span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d20f39">val</span> <span style="color:#d20f39">reposInfo</span> <span style="color:#04a5e5;font-weight:bold">=</span> repositoryService<span style="color:#04a5e5;font-weight:bold">.</span>repositoriesOf<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#04a5e5;font-weight:bold">).?</span> <span style="color:#9ca0b0;font-style:italic">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>      <span style="color:#04a5e5;font-weight:bold">.</span>map<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">_</span><span style="color:#04a5e5;font-weight:bold">.</span>performAnalysis<span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#9ca0b0;font-style:italic">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>    <span style="color:#8839ef">val</span> collector <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Collector</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">](</span>reposInfo<span style="color:#04a5e5;font-weight:bold">.</span>toList<span style="color:#04a5e5;font-weight:bold">*)</span> <span style="color:#9ca0b0;font-style:italic">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>    <span style="color:#8839ef">for</span> <span style="color:#8839ef">_</span> <span style="color:#8839ef">&lt;-</span> reposInfo<span style="color:#04a5e5;font-weight:bold">.</span>indices <span style="color:#8839ef">do</span> 
</span></span><span style="display:flex;"><span>      updateResults<span style="color:#04a5e5;font-weight:bold">(</span>collector<span style="color:#04a5e5;font-weight:bold">.</span>results<span style="color:#04a5e5;font-weight:bold">.</span>read<span style="color:#04a5e5;font-weight:bold">().</span>toTry<span style="color:#04a5e5;font-weight:bold">().?.</span>awaitResult<span style="color:#04a5e5;font-weight:bold">.?)</span> <span style="color:#9ca0b0;font-style:italic">// 4
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>    reposInfo<span style="color:#04a5e5;font-weight:bold">.</span>map<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">_</span><span style="color:#04a5e5;font-weight:bold">.</span>await<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  extension <span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#8839ef">:</span> <span style="color:#d20f39">Repository</span><span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">private</span> <span style="color:#8839ef">def</span> performAnalysis<span style="color:#04a5e5;font-weight:bold">(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Future</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]</span> <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Future</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#d20f39">val</span> <span style="color:#d20f39">contributions</span> <span style="color:#04a5e5;font-weight:bold">=</span> <span style="color:#df8e1d">Future</span> <span style="color:#04a5e5;font-weight:bold">{</span> repositoryService<span style="color:#04a5e5;font-weight:bold">.</span>contributorsOf<span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#04a5e5;font-weight:bold">.</span>organization<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>name<span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#04a5e5;font-weight:bold">}</span> <span style="color:#9ca0b0;font-style:italic">// concurrent
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>      <span style="color:#8839ef">val</span> release <span style="color:#8839ef">=</span> repositoryService<span style="color:#04a5e5;font-weight:bold">.</span>lastReleaseOf<span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#04a5e5;font-weight:bold">.</span>organization<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>name<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#df8e1d">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#04a5e5;font-weight:bold">.</span>name<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>issues<span style="color:#04a5e5;font-weight:bold">,</span> r<span style="color:#04a5e5;font-weight:bold">.</span>stars<span style="color:#04a5e5;font-weight:bold">,</span> contributions<span style="color:#04a5e5;font-weight:bold">.</span>await<span style="color:#04a5e5;font-weight:bold">.</span>getOrElse<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#df8e1d">Seq</span><span style="color:#04a5e5;font-weight:bold">()),</span> release<span style="color:#04a5e5;font-weight:bold">.</span>toOption<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span></code></pre></div><ol>
<li>first, we get all the repositories of the requested organization</li>
<li>for each of them, the contributors and the last release are retrieved concurrently, starting a <code>Future</code></li>
<li><code>Future</code> results are gathered inside a <strong><code>Collector</code></strong> allowing to collect a list of futures into a channel of futures, arriving as they finish.
<ul>
<li>the retrieval of the contributors and the last release are performed in parallel</li>
</ul>
</li>
<li>read results from the channel as they come, calling the <code>updateResult</code> reaction function.</li>
</ol>
<p>Although it works, the proposed solution suffers from a performance issue when the organization we want to analyze has a large number of repositories.
Indeed, the GitHub API, like many ReSTful APIs, implements <em>pagination</em>: if the response includes many results, they are paginated, returning a subset of them; it is the responsibility of the client to request more data (pages).
Until now, the <code>RepositoryService</code> has been implemented to return the whole results in one shot, leading to suspension until all pages are retrieved.
It would be desirable, instead, to start performing the analysis as soon as one page is obtained from the API.</p>
<p>To do so, the interface of the <code>RepositoryService</code> has been extended with new methods, <code>incremental***</code>, returning a terminable channel of results:</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">trait</span> <span style="color:#df8e1d">RepositoryService</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">def</span> <span style="color:#d20f39">incrementalRepositoriesOf</span><span style="color:#04a5e5;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#d20f39">organizationName:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">ReadableChannel</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Terminable</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Repository</span><span style="color:#04a5e5;font-weight:bold">]]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">def</span> incrementalContributorsOf<span style="color:#04a5e5;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      repositoryName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">ReadableChannel</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Terminable</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Contribution</span><span style="color:#04a5e5;font-weight:bold">]]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#9ca0b0;font-style:italic">// ...
</span></span></span></code></pre></div><hr>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="conclusions">
  Conclusions
  <a class="anchor" href="#conclusions">#</a>
</h2>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/tassiLuca/PPS-22-direct-style-experiments/commit/fc00e499f04523e4b9168eaec03792225edfe010" title='Last modified by Luca Tassinari | February 29, 2024' target="_blank" rel="noopener">
      <img src="/PPS-22-direct-style-experiments/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>February 29, 2024</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>
</html>












