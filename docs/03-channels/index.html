<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Channels as a communication primitive # The fourth, yet not mentioned, abstraction of both Kotlin Coroutines and Scala Gears is the channel. Channels represent the primitive communication and coordination means to exchange Future results. They are, at least conceptually, very similar to a queue where it is possible to send (and receive) data &ndash; basically, exploiting the producer-consumer pattern.
classDiagram class `SendableChannel[-T]` { &lt;&lt; trait &gt;&gt; &#43;sendSource(x: T) Async.Source[Either[Closed, Unit]] &#43;send(x: T)(using Async) Unit } class `ReadableChannel[&#43;T]` { &lt;&lt; trait &gt;&gt; &#43;readSource Async.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="Channels as a communication primitive # The fourth, yet not mentioned, abstraction of both Kotlin Coroutines and Scala Gears is the channel. Channels represent the primitive communication and coordination means to exchange Future results. They are, at least conceptually, very similar to a queue where it is possible to send (and receive) data &ndash; basically, exploiting the producer-consumer pattern.
classDiagram class `SendableChannel[-T]` { &lt;&lt; trait &gt;&gt; &#43;sendSource(x: T) Async.Source[Either[Closed, Unit]] &#43;send(x: T)(using Async) Unit } class `ReadableChannel[&#43;T]` { &lt;&lt; trait &gt;&gt; &#43;readSource Async." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tassiluca.github.io/PPS-22-direct-style-experiments/docs/03-channels/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2024-02-22T11:01:27+01:00" />

<title>03 Channels | PPS-22-direct-style-experiments</title>
<link rel="manifest" href="/PPS-22-direct-style-experiments/manifest.json">
<link rel="icon" href="/PPS-22-direct-style-experiments/favicon.png" >
<link rel="canonical" href="https://tassiluca.github.io/PPS-22-direct-style-experiments/docs/03-channels/">
<link rel="stylesheet" href="/PPS-22-direct-style-experiments/book.min.52e9c97a2cdb2f96e1db1d9e68e4f7a24ffeb36d11f3e9913b0126d572bfff9f.css" integrity="sha256-UunJeizbL5bh2x2eaOT3ok/&#43;s20R8&#43;mROwEm1XK//58=" crossorigin="anonymous">
  <script defer src="/PPS-22-direct-style-experiments/flexsearch.min.js"></script>
  <script defer src="/PPS-22-direct-style-experiments/en.search.min.ab4267e75236ada82371ce248ae32c029db3d55c83940108e85b57f0316758f7.js" integrity="sha256-q0Jn51I2ragjcc4kiuMsAp2z1VyDlAEI6FtX8DFnWPc=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/PPS-22-direct-style-experiments/"><span>PPS-22-direct-style-experiments</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/01-boundaries/" class="">01 Boundaries</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/02-basics/" class="">02 Basics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/03-channels/" class="active">03 Channels</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/04-rears/" class="">04 Rears</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/PPS-22-direct-style-experiments/docs/05-conclusions/" class="">05 Conclusions</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/PPS-22-direct-style-experiments/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>03 Channels</strong>

  <label for="toc-control">
    
    <img src="/PPS-22-direct-style-experiments/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#github-organization-analyzer-example">GitHub organization analyzer example</a>
      <ul>
        <li><a href="#analyzer-and-app-controller">Analyzer and App Controller</a></li>
        <li><a href="#github-service">GitHub service</a></li>
      </ul>
    </li>
    <li><a href="#conclusions">Conclusions</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="channels-as-a-communication-primitive">
  Channels as a communication primitive
  <a class="anchor" href="#channels-as-a-communication-primitive">#</a>
</h1>
<p>The fourth, yet not mentioned, abstraction of both Kotlin Coroutines and Scala Gears is the <strong>channel</strong>.
Channels represent the primitive communication and coordination means to exchange <code>Future</code> results. They are, at least conceptually, very similar to a queue where it is possible to send (and receive) data &ndash; basically, exploiting the <em><strong>producer-consumer</strong></em> pattern.</p>


<script src="/PPS-22-direct-style-experiments/mermaid.min.js"></script>

  <script>mermaid.initialize({
    "flowchart": {
        "useMaxWidth":true
    },
    "theme": "default"
})</script>




<p class="mermaid">
classDiagram
  class `SendableChannel[-T]` {
    << trait >>
    +sendSource(x: T) Async.Source[Either[Closed, Unit]]
    +send(x: T)(using Async) Unit
  }

  class `ReadableChannel[+T]` {
    << trait >>
    +readSource Async.Source[Either[Closed, T]]
    +read()(using Async) Either[Closed, T]
  }

  class `Channel[T]` {
    << trait >>
    +asSendable: SendableChannel[T]
    +asReadable: ReadableChannel[T]
    +asCloseable: java.io.Closeable
  }

  namespace java io {
    class Closeable {
      << interface >>
      +close()
    }
  }

  `SendableChannel[-T]` <|-- `Channel[T]`
  Closeable <|-- `Channel[T]`
  `ReadableChannel[+T]` <|-- `Channel[T]`
</p>

<p>The channel is defined through three distinct interfaces: <code>SendableChannel[-T]</code>, <code>ReadableChannel[+T]</code> and <code>Channel[T]</code>, where the latter extends from both <code>SendableChannel</code> and <code>ReadableChannel</code>. Typically, a <code>Channel</code> is created and a <code>SendableChannel</code> and <code>ReadableChannel</code> instances are respectively provided to the producer and the consumer, restricting their access to it. The same design is present also in Kotlin Coroutines.</p>
<p>Moreover, <code>Channel</code> inherits from <code>java.io.Closable</code>, making them closable objects: once closed, they raise <code>ChannelClosedException</code> when attempting to write to it and immediately return a <code>Failure(ChannelClosedException)</code> when attempting to read from it.</p>
<p>Three types of channels exist:</p>
<ul>
<li><strong>Synchronous Channels</strong>: links a read request with a send request within a <em>rendezvous</em>
<ul>
<li><code>send</code> (<code>read</code>) suspend the process until a consumer <code>read</code> (<code>send</code>) the value;</li>
</ul>
</li>
<li><strong>Buffered Channels</strong>: a version of a channel with an internal buffer of fixed size
<ul>
<li><code>send</code> suspend the producer process if it is full; otherwise, it appends the value to the buffer, returning immediately;</li>
<li><code>read</code> suspend if the channel is empty, waiting for a new value.</li>
</ul>
</li>
<li><strong>Unbounded Channels</strong>: a version of a channel with an unbounded buffer
<ul>
<li>if the programs run out of memory you can get an out-of-memory exception!</li>
</ul>
</li>
</ul>
<blockquote>
<p>Multiple producers can send data to the channel, as well as multiple consumers can read them, <strong>but each element is handled only <em>once</em>, by <em>one</em> of them</strong>, i.e. consumers <strong>compete</strong> with each other for sent values. Once the element is handled, it is immediately removed from the channel.</p>
</blockquote>
<h2 id="github-organization-analyzer-example">
  GitHub organization analyzer example
  <a class="anchor" href="#github-organization-analyzer-example">#</a>
</h2>
<p>To show channels in action an example has been prepared:</p>
<blockquote class="book-hint info">
  <strong>Idea</strong>: we want to realize a little asynchronous library allowing clients to collect the common statistics about repositories (issues, stars, last release) and contributors of a given GitHub organization.
</blockquote>

<p>Final result:</p>
<p><img src="../../res/img/analyzer-e2e.png" alt="expected result" /></p>
<p>As usual, the example has been implemented using monadic <code>Future</code>s, as well as Scala gears and Kotlin Coroutines.</p>
<h3 id="analyzer-and-app-controller">
  Analyzer and App Controller
  <a class="anchor" href="#analyzer-and-app-controller">#</a>
</h3>
<p>The direct version in Scala gears exposes the following interface, taking in input an organization name and a function through which is possible to react to results while they are computed.</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">trait</span> <span style="color:#df8e1d">Analyzer</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">def</span> <span style="color:#d20f39">analyze</span><span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#d20f39">organizationName:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#d20f39">updateResults:</span> <span style="color:#d20f39">RepositoryReport</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span> <span style="color:#d20f39">Unit</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">object</span> <span style="color:#df8e1d">Analyzer</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">def</span> <span style="color:#d20f39">ofGitHub:</span> <span style="color:#d20f39">Analyzer</span> <span style="color:#04a5e5;font-weight:bold">=</span> <span style="color:#df8e1d">GitHubAnalyzer</span><span style="color:#04a5e5;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">private</span> <span style="color:#8839ef">class</span> <span style="color:#df8e1d">GitHubAnalyzer</span> <span style="color:#8839ef">extends</span> <span style="color:#df8e1d">Analyzer</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d20f39">private</span> <span style="color:#d20f39">val</span> <span style="color:#d20f39">gitHubService</span> <span style="color:#04a5e5;font-weight:bold">=</span> <span style="color:#df8e1d">GitHubService</span><span style="color:#04a5e5;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">override</span> <span style="color:#8839ef">def</span> analyze<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)(</span>
</span></span><span style="display:flex;"><span>        updateResults<span style="color:#8839ef">:</span> <span style="color:#d20f39">RepositoryReport</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span> <span style="color:#df8e1d">Unit</span><span style="color:#04a5e5;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#04a5e5;font-weight:bold">)(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Either</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Seq</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]]</span> <span style="color:#8839ef">=</span> either<span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#d20f39">val</span> <span style="color:#d20f39">reposInfo</span> <span style="color:#04a5e5;font-weight:bold">=</span> gitHubService
</span></span><span style="display:flex;"><span>        <span style="color:#04a5e5;font-weight:bold">.</span>repositoriesOf<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#04a5e5;font-weight:bold">).?</span> <span style="color:#9ca0b0;font-style:italic">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>        <span style="color:#04a5e5;font-weight:bold">.</span>map<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">_</span><span style="color:#04a5e5;font-weight:bold">.</span>performAnalysis<span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#9ca0b0;font-style:italic">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>      <span style="color:#8839ef">val</span> collector <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Collector</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">](</span>reposInfo<span style="color:#04a5e5;font-weight:bold">.</span>toList<span style="color:#04a5e5;font-weight:bold">*)</span> <span style="color:#9ca0b0;font-style:italic">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>      <span style="color:#8839ef">for</span> <span style="color:#8839ef">_</span> <span style="color:#8839ef">&lt;-</span> reposInfo<span style="color:#04a5e5;font-weight:bold">.</span>indices <span style="color:#8839ef">do</span> 
</span></span><span style="display:flex;"><span>        updateResults<span style="color:#04a5e5;font-weight:bold">(</span>collector<span style="color:#04a5e5;font-weight:bold">.</span>results<span style="color:#04a5e5;font-weight:bold">.</span>read<span style="color:#04a5e5;font-weight:bold">().</span>tryable<span style="color:#04a5e5;font-weight:bold">.?.</span>awaitResult<span style="color:#04a5e5;font-weight:bold">.?)</span> <span style="color:#9ca0b0;font-style:italic">// 4
</span></span></span><span style="display:flex;"><span><span style="color:#9ca0b0;font-style:italic"></span>      reposInfo<span style="color:#04a5e5;font-weight:bold">.</span>map<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">_</span><span style="color:#04a5e5;font-weight:bold">.</span>await<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    extension <span style="color:#04a5e5;font-weight:bold">(</span>r<span style="color:#8839ef">:</span> <span style="color:#d20f39">Repository</span><span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#8839ef">private</span> <span style="color:#8839ef">def</span> performAnalysis<span style="color:#04a5e5;font-weight:bold">(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Future</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">]</span> <span style="color:#8839ef">=</span> <span style="color:#04a5e5;font-weight:bold">???</span>
</span></span></code></pre></div><ol>
<li>first, we get all the repositories of the requested organization</li>
<li>for each of them, the contributors and the last release are retrieved concurrently, starting a <code>Future</code></li>
<li><code>Future</code> results are gathered inside a <code>Collector</code> that collects a list of futures into a channel of futures, arriving as they finish.</li>
<li>read results from the channel as they come, calling the <code>updateResult</code> reaction function.</li>
</ol>
<p>The application controller just takes care of running the application view and, whenever a new analysis starts, creates a new future, during which the single reports are aggregated and the UI is updated.
Thanks to the fact <code>Future</code>s are cancellable objects, whenever desired is possible to cancel the current computation.</p>
<div class="highlight"><pre tabindex="0" style="color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#8839ef">private</span> <span style="color:#8839ef">class</span> <span style="color:#df8e1d">DirectAppController</span><span style="color:#04a5e5;font-weight:bold">(</span>using <span style="color:#df8e1d">Async</span><span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#8839ef">extends</span> <span style="color:#df8e1d">AppController</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d20f39">private</span> <span style="color:#d20f39">val</span> <span style="color:#d20f39">view</span> <span style="color:#04a5e5;font-weight:bold">=</span> <span style="color:#df8e1d">AnalyzerView</span><span style="color:#04a5e5;font-weight:bold">.</span>gui<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">this</span><span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">private</span> <span style="color:#8839ef">val</span> analyzer <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Analyzer</span><span style="color:#04a5e5;font-weight:bold">.</span>ofGitHub
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">private</span> <span style="color:#8839ef">var</span> currentComputation<span style="color:#8839ef">:</span> <span style="color:#d20f39">Option</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Future</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">Unit</span><span style="color:#04a5e5;font-weight:bold">]]</span> <span style="color:#8839ef">=</span> <span style="color:#df8e1d">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  view<span style="color:#04a5e5;font-weight:bold">.</span>run<span style="color:#04a5e5;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">override</span> <span style="color:#8839ef">def</span> runSession<span style="color:#04a5e5;font-weight:bold">(</span>organizationName<span style="color:#8839ef">:</span> <span style="color:#d20f39">String</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Unit</span> <span style="color:#04a5e5;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">var</span> organizationReport<span style="color:#8839ef">:</span> <span style="color:#d20f39">OrganizationReport</span> <span style="color:#04a5e5;font-weight:bold">=</span> <span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#df8e1d">Map</span><span style="color:#04a5e5;font-weight:bold">(),</span> <span style="color:#df8e1d">Set</span><span style="color:#04a5e5;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">val</span> f <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Future</span><span style="color:#8839ef">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#d20f39">analyzer.analyze</span><span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#d20f39">organizationName</span><span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#04a5e5;font-weight:bold">{</span> <span style="color:#d20f39">report</span> <span style="color:#04a5e5;font-weight:bold">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d20f39">organizationReport</span> <span style="color:#04a5e5;font-weight:bold">=</span> <span style="color:#04a5e5;font-weight:bold">(</span>organizationReport<span style="color:#04a5e5;font-weight:bold">.</span>_1<span style="color:#04a5e5;font-weight:bold">.</span>aggregatedTo<span style="color:#04a5e5;font-weight:bold">(</span>report<span style="color:#04a5e5;font-weight:bold">),</span> organizationReport<span style="color:#04a5e5;font-weight:bold">.</span>_2 <span style="color:#04a5e5;font-weight:bold">+</span> report<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        view<span style="color:#04a5e5;font-weight:bold">.</span>update<span style="color:#04a5e5;font-weight:bold">(</span>organizationReport<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#04a5e5;font-weight:bold">}</span> <span style="color:#8839ef">match</span> <span style="color:#04a5e5;font-weight:bold">{</span> <span style="color:#8839ef">case</span> <span style="color:#df8e1d">Left</span><span style="color:#04a5e5;font-weight:bold">(</span>e<span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#8839ef">=&gt;</span> view<span style="color:#04a5e5;font-weight:bold">.</span>error<span style="color:#04a5e5;font-weight:bold">(</span>e<span style="color:#04a5e5;font-weight:bold">);</span> <span style="color:#8839ef">case</span> <span style="color:#df8e1d">Right</span><span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">_</span><span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#8839ef">=&gt;</span> view<span style="color:#04a5e5;font-weight:bold">.</span>endComputation<span style="color:#04a5e5;font-weight:bold">()</span> <span style="color:#04a5e5;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    currentComputation <span style="color:#8839ef">=</span> <span style="color:#df8e1d">Some</span><span style="color:#04a5e5;font-weight:bold">(</span>f<span style="color:#04a5e5;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8839ef">override</span> <span style="color:#8839ef">def</span> stopSession<span style="color:#04a5e5;font-weight:bold">()</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Unit</span> <span style="color:#04a5e5;font-weight:bold">=</span> currentComputation<span style="color:#04a5e5;font-weight:bold">.</span>foreach<span style="color:#04a5e5;font-weight:bold">(</span><span style="color:#8839ef">_</span><span style="color:#04a5e5;font-weight:bold">.</span>cancel<span style="color:#04a5e5;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  extension <span style="color:#04a5e5;font-weight:bold">(</span>m<span style="color:#8839ef">:</span> <span style="color:#d20f39">Map</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Long</span><span style="color:#04a5e5;font-weight:bold">])</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8839ef">private</span> <span style="color:#8839ef">def</span> aggregatedTo<span style="color:#04a5e5;font-weight:bold">(</span>report<span style="color:#8839ef">:</span> <span style="color:#d20f39">RepositoryReport</span><span style="color:#04a5e5;font-weight:bold">)</span><span style="color:#8839ef">:</span> <span style="color:#d20f39">Map</span><span style="color:#04a5e5;font-weight:bold">[</span><span style="color:#d20f39">String</span>, <span style="color:#d20f39">Long</span><span style="color:#04a5e5;font-weight:bold">]</span> <span style="color:#8839ef">=</span>
</span></span><span style="display:flex;"><span>      m <span style="color:#04a5e5;font-weight:bold">++</span> report<span style="color:#04a5e5;font-weight:bold">.</span>contributions<span style="color:#04a5e5;font-weight:bold">.</span>map<span style="color:#04a5e5;font-weight:bold">(</span>c <span style="color:#8839ef">=&gt;</span> c<span style="color:#04a5e5;font-weight:bold">.</span>user <span style="color:#04a5e5;font-weight:bold">-&gt;</span> <span style="color:#04a5e5;font-weight:bold">(</span>m<span style="color:#04a5e5;font-weight:bold">.</span>getOrElse<span style="color:#04a5e5;font-weight:bold">(</span>c<span style="color:#04a5e5;font-weight:bold">.</span>user<span style="color:#04a5e5;font-weight:bold">,</span> <span style="color:#fe640b">0L</span><span style="color:#04a5e5;font-weight:bold">)</span> <span style="color:#04a5e5;font-weight:bold">+</span> c<span style="color:#04a5e5;font-weight:bold">.</span>contributions<span style="color:#04a5e5;font-weight:bold">))</span>
</span></span></code></pre></div><p>The Kotlin version with Coroutines is pretty identical to the Gears one.</p>
<h3 id="github-service">
  GitHub service
  <a class="anchor" href="#github-service">#</a>
</h3>
<p>One point of difference between the two frameworks is, however, how the <code>GitHubService</code> can be implemented, regarding the case where, not just a single, but a multitude of values, are expected.</p>
<p>Indeed, the GitHub API, like many ReSTful APIs, implements <em>pagination</em>: if the response includes many results, they are paginated, returning a subset of them; it is the responsibility of the client to request more data (pages).</p>
<p>This can lead to performance issues if the service is implemented to return the whole results in one shot. It would be desirable, instead, to start performing the analysis as soon as one page is obtained from the API.</p>
<p>Kotlin Coroutines offers, for this purpose, the abstraction of <strong>Flow</strong>s, which are conceptually very similar to <strong>cold <code>Observable</code>s</strong> in reactive programming.</p>
<p>With respect to reactive programming, they are still quite less reach in terms of operators.</p>
<hr>
<ul>
<li>Channels in Kotlin (w.r.t. gears)
<ul>
<li>fairness (also in Gears?)</li>
<li>pipeline (not supported in Gears)</li>
<li>better closable</li>
</ul>
</li>
</ul>
<hr>
<h2 id="conclusions">
  Conclusions
  <a class="anchor" href="#conclusions">#</a>
</h2>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/tassiLuca/PPS-22-direct-style-experiments/commit/58419fa40065e73a1c79eb0bf81a3a743104532b" title='Last modified by Luca Tassinari | February 22, 2024' target="_blank" rel="noopener">
      <img src="/PPS-22-direct-style-experiments/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>February 22, 2024</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#github-organization-analyzer-example">GitHub organization analyzer example</a>
      <ul>
        <li><a href="#analyzer-and-app-controller">Analyzer and App Controller</a></li>
        <li><a href="#github-service">GitHub service</a></li>
      </ul>
    </li>
    <li><a href="#conclusions">Conclusions</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












